- file:
    path: "stacks/{{ template.path }}"
    state: directory
    recurse: yes
  when: template.state == 'directory'
- name: "Generate {{ template.name }}"
  template:
    src: "{{ template.src }}"
    dest: "stacks/{{ template.path | regex_replace('.j2$', '') }}"
  when: template.state == 'file' and template.path is regex(".*\.j2")
- name: "Generate {{ template.name }}"
  copy:
    src: "{{ template.src }}"
    dest: "stacks/{{ template.path | regex_replace('.j2$', '') }}"
  when: template.state == 'file' and template.path is not regex(".*\.j2")

